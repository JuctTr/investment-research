# 投研分析系统技术方案设计（TDD · MVP 精简版）

---

## 1. 文档目的与适用范围

### 1.1 文档目的

- 统一研发阶段的技术认知与边界
- 明确前后端技术选型与模块职责
- 为编码、评审、后续演进提供稳定依据

### 1.2 适用阶段

- 产品阶段：工程化 MVP
- 用户规模：个人 / 极小团队
- 核心目标：**验证“观点 → 决策 → 复盘”的学习闭环是否成立**

---

## 2. 技术设计总原则（MVP 约束）

1. **单体优先，不引入分布式复杂性**
2. **模块化边界用于约束思维，而非增加运行成本**
3. **AI 只作为受限工具，不参与结论生成**
4. **所有学习价值必须来自人类显式决策与复盘**
5. **优先降低心智负担，而非追求技术完备性**

---

## 3. 总体技术架构设计

### 3.1 架构形态

采用 **模块化单体架构（Modular Monolith）**：

- 逻辑上按业务模块拆分
- 物理部署为单一应用
- 不引入微服务、消息总线、复杂队列

### 3.2 架构分层

- **表现层**：Web Frontend（决策与复盘工具）
- **应用层**：Backend Application（业务流程编排）
- **领域模块层**：Content / Viewpoint / Decision / Review
- **基础设施层**：DB / Scheduler / AI / Notification

---

## 4. 前端技术方案设计

### 4.1 前端定位

前端仅承担三项职责：

1. 展示后端生成的结构化数据
2. 收集用户的显式判断与复盘信息
3. 触发明确的业务状态迁移

> 前端 不包含任何业务推断或隐式规则。
> 

### 4.2 技术选型

| 层级 | 技术选型 |
| --- | --- |
| 框架 | React + TypeScript |
| 构建工具 | Vite |
| UI 组件库 | Ant Design |
| 路由 | React Router |
| 数据请求 | React Query |
| 状态管理 | Zustand |

### 4.3 页面模块划分

- 内容列表页（Content List）
- 观点详情页（Viewpoint Detail）
- 决策录入页（Decision Form）
- 决策状态列表页（Decision Board）
- 复盘编辑页（Review Editor）

---

## 5. 后端技术方案设计

### 5.1 技术栈选型

| 层级 | 技术 |
| --- | --- |
| 运行时 | Node.js |
| 语言 | TypeScript |
| 框架 | NestJS |
| ORM | Prisma |
| 数据库 | PostgreSQL |

### 5.2 模块拆分

部分模块拆分

```
src/
 ├─ modules/
 │   ├─ content/        // 内容源配置与采集
 │   ├─ processing/     // 文本清洗与段落切分
 │   ├─ ai/             // AI 受限调用
 │   ├─ viewpoint/      // 观点建模与生命周期
 │   ├─ decision/       // 个人决策模块
 │   ├─ review/         // 复盘模块
 │   └─ notify/         // 飞书 Bot 通知
 ├─ scheduler/          // 定时任务（采集 / AI / 复盘）
 ├─ common/             // 通用工具与基础设施

```

约束原则：

- 模块间通过 Service 接口通信
- 禁止跨模块直接访问数据库

---

## 6. 数据模型设计原则（概要）

### 6.1 核心实体

- Content（内容）
- Viewpoint（观点）
- Decision（个人决策）
- Review（复盘）
- Author（作者）
- Asset（资产对象）

### 6.2 关键设计约束

- 观点与决策生命周期严格分离
- 决策与复盘记录不可覆盖，仅追加
- AI 结果仅作为中间分析数据

---

## 7. AI 模块技术方案（受限模式）

### 7.1 使用边界

- AI 不输出“是否操作”建议
- AI 不做观点正确性判断
- AI 仅输出结构化中间判断

### 7.2 AI 输出最小 Schema

```tsx
interface AIViewpointResult {
  hasViewpoint: 'yes' | 'no' | 'ambiguous'
  asset: string | null
  stance: 'long' | 'short' | 'neutral' | 'unknown'
  evidenceParagraphIds: string[]
  risks?: string[]
  assumptions?: string[]
}

```

其中：

- 核心字段强约束
- risks / assumptions 允许弱结构化（JSONB）

---

## 8. 异步任务与调度设计（MVP 简化版）

### 8.1 任务类型

| 任务 | 实现方式 |
| --- | --- |
| 内容采集 | 定时任务 + 状态字段 |
| AI 分析 | 定时扫描 PENDING_AI |
| 复盘提醒 | 到期时间扫描 |

### 8.2 技术方案

- 使用 node-cron
- 不引入独立消息队列
- 数据库状态字段作为任务驱动

---

## 9. API 设计原则

- API 直接表达业务意图
- 不设计通用流程 / 状态机引擎
- 状态迁移通过明确语义接口完成

示例：

- POST /viewpoints/{id}/enter-decision
- POST /decisions/{id}/review

---

## 10. 部署与环境设计

### 10.1 MVP 部署方式

- 单实例部署
- Docker Compose 管理
- 前端 / 后端 / 数据库分容器

### 10.2 环境区分

- development
- production

---

## 11. 安全与合规

- 明确非投资建议声明
- 内容来源可追溯
- 决策与复盘操作全量记录
- 系统仅供授权用户使用

---

## 12. 演进边界（暂不实现）

- 微服务拆分
- AI 观点评分
- 作者影响力建模
- 多用户体系

---

## 13. 推荐实施顺序

1. 核心数据表（Content / Viewpoint / Decision / Review）
2. 决策与复盘核心 API
3. 内容采集 + AI 受限分析
4. 前端决策与复盘页面
5. 飞书 Bot 推送与提醒

---
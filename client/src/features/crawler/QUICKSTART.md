# 爬虫模块快速启动指南

## 启动项目

```bash
# 1. 进入前端目录
cd client

# 2. 启动开发服务器
pnpm dev

# 3. 访问地址
http://localhost:3001
```

## 访问页面

### 信息源管理页面
```
http://localhost:3001/crawler/sources
```

**功能**：
- 查看所有信息源列表
- 添加新信息源（点击"添加信息源"按钮）
- 编辑信息源（点击操作列的编辑按钮）
- 删除信息源（单个删除或批量删除）
- 启动/停止爬取（点击播放/暂停图标）

### 任务监控页面
```
http://localhost:3001/crawler
```

**功能**：
- 查看所有任务列表
- 状态筛选（全部/待处理/运行中/成功/失败/已取消）
- 智能轮询（页面可见时自动轮询，有运行中任务时5秒刷新）
- 查看任务详情（点击眼睛图标，跳转到预览页面）
- 取消任务（仅对待处理或运行中的任务有效）

### 数据预览页面
```
http://localhost:3001/crawler/preview/{taskId}
```

**功能**：
- 查看任务详细信息
- 查看爬取结果的JSON数据
- 复制JSON到剪贴板
- 下载JSON文件

## Mock数据说明

项目使用MSW (Mock Service Worker)在开发环境模拟后端API。Mock数据会自动生成，包括：

### 信息源数据
- 自动生成10条示例信息源
- 包含雪球用户、雪球动态、微信公众号、RSS订阅等类型
- 每条数据都有完整的状态、时间戳等信息

### 任务数据
- 自动生成20条示例任务
- 包含不同的状态（PENDING、RUNNING、SUCCESS、FAILED、CANCELLED）
- 包含进度信息、时间戳等

**注意**：Mock数据在开发环境自动启用，生产环境会自动禁用。

## 使用示例

### 示例1：添加新信息源

1. 访问信息源管理页面
2. 点击"添加信息源"按钮
3. 填写表单：
   - 名称：`雪球大V`
   - 类型：`雪球用户`
   - URL：`https://xueqiu.com/u/123456`
4. 点击"确定"

### 示例2：启动爬取

1. 在信息源列表找到要启动的信息源
2. 点击操作列的"播放"图标
3. 系统会创建爬取任务并自动启动
4. 切换到任务监控页面查看进度

### 示例3：查看任务结果

1. 访问任务监控页面
2. 找到已完成（SUCCESS状态）的任务
3. 点击操作列的"眼睛"图标
4. 在预览页面查看JSON结果
5. 点击"复制JSON"或"下载JSON"保存结果

## 智能轮询说明

任务监控页面使用智能轮询机制：

### 自动轮询条件
- ✅ 页面可见（用户当前查看此页面）
- ✅ 有运行中或待处理的任务

### 自动暂停条件
- ❌ 页面隐藏（用户切换到其他标签页）
- ❌ 所有任务已完成或失败

### 手动控制
- 点击"开始轮询"按钮强制启动轮询
- 点击"停止轮询"按钮强制停止轮询
- 点击"刷新"按钮手动刷新一次

## 开发工具

### React Query DevTools
开发环境会自动显示React Query DevTools，可以查看：
- 查询缓存状态
- 请求历史
- 数据 Fresh/Stale 状态

### 浏览器控制台
打开控制台可以看到：
- `[MSW] Mock Service Worker 已启动` - MSW启动成功
- API请求和响应的详细信息
- 错误日志

## 故障排查

### 问题1：页面显示"加载失败"
**原因**：MSW未正确启动
**解决**：
1. 检查控制台是否有`[MSW]`日志
2. 刷新页面重试
3. 确认`public/mockServiceWorker.js`文件存在

### 问题2：操作后没有反应
**原因**：浏览器拦截了请求
**解决**：
1. 打开控制台查看错误信息
2. 检查网络请求是否正常
3. 确认Mock handlers是否正确配置

### 问题3：轮询不工作
**原因**：没有运行中的任务或页面隐藏
**解决**：
1. 确认有PENDING或RUNNING状态的任务
2. 确认页面是可见状态（没有切换标签页）
3. 点击"开始轮询"手动启动

## 下一步

1. **连接真实后端**：将Mock API替换为真实的后端API
2. **添加测试**：编写单元测试和E2E测试
3. **性能优化**：添加虚拟滚动、懒加载等
4. **功能增强**：添加WebSocket实时推送、高级筛选等

## 技术支持

如有问题，请查看：
- `/client/src/features/crawler/README.md` - 详细文档
- 代码中的注释 - 每个函数都有详细说明
- TypeScript类型定义 - 了解数据结构
